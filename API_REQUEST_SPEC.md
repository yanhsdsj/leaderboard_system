# æ’è¡Œæ¦œç³»ç»Ÿ API è¯·æ±‚è§„èŒƒ

## ğŸ“Œ æäº¤ä½œä¸šæ¥å£

### åŸºæœ¬ä¿¡æ¯
- **URL**: `/api/submit`
- **Method**: `POST`
- **Content-Type**: `application/json`

---

## ğŸ“¤ è¯·æ±‚ä½“ (Request Body)

### å®Œæ•´ç¤ºä¾‹
```json
{
  "student_info": {
    "student_id": "2021001234",
    "name": "å¼ ä¸‰",
    "nickname": "ä»£ç å°èƒ½æ‰‹"
  },
  "assignment_id": "01",
  "metrics": {
    "MAE": 0.1234,
    "MSE": 0.5678,
    "RMSE": 0.7536,
    "Prediction_Time": 12.34
  },
  "checksums": {
    "evaluate.py": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
  }
}
```

### å­—æ®µè¯´æ˜

#### 1. `student_info` (å¯¹è±¡ï¼Œå¿…å¡«)
å­¦ç”Ÿä¿¡æ¯å¯¹è±¡

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `student_id` | string | âœ… æ˜¯ | å­¦ç”Ÿå­¦å·ï¼Œå”¯ä¸€æ ‡è¯† | "2021001234" |
| `name` | string | âœ… æ˜¯ | å­¦ç”Ÿå§“å | "å¼ ä¸‰" |
| `nickname` | string | âŒ å¦ | å­¦ç”Ÿæ˜µç§°ï¼ˆå¯é€‰ï¼‰ | "ä»£ç å°èƒ½æ‰‹" |

#### 2. `assignment_id` (å­—ç¬¦ä¸²ï¼Œå¿…å¡«)
ä½œä¸šç¼–å·

- **ç±»å‹**: string
- **å¿…å¡«**: âœ… æ˜¯
- **è¯´æ˜**: ä½œä¸šçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…é¡»åœ¨ç³»ç»Ÿä¸­å­˜åœ¨
- **ç¤ºä¾‹**: `"01"`, `"02"`, `"03"`

#### 3. `metrics` (å¯¹è±¡ï¼Œå¿…å¡«)
è¯„ä¼°æŒ‡æ ‡å¯¹è±¡ï¼Œæ‰€æœ‰å­—æ®µå‡ä¸ºå¿…å¡«

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `MAE` | float | âœ… æ˜¯ | å¹³å‡ç»å¯¹è¯¯å·® | 0.1234 |
| `MSE` | float | âœ… æ˜¯ | å‡æ–¹è¯¯å·® | 0.5678 |
| `RMSE` | float | âœ… æ˜¯ | å‡æ–¹æ ¹è¯¯å·®ï¼ˆä¸»æ’åºæŒ‡æ ‡ï¼‰ | 0.7536 |
| `Prediction_Time` | float | âœ… æ˜¯ | æ¨ç†æ—¶é—´ï¼ˆç§’ï¼Œæ¬¡æ’åºæŒ‡æ ‡ï¼‰ | 12.34 |

**æ’åºè§„åˆ™**ï¼š
1. ä¼˜å…ˆæŒ‰ `RMSE` å‡åºï¼ˆè¶Šå°è¶Šå¥½ï¼‰
2. RMSEç›¸åŒæ—¶æŒ‰ `Prediction_Time` å‡åºï¼ˆè¶Šå°è¶Šå¥½ï¼‰
3. éƒ½ç›¸åŒæ—¶æŒ‰æäº¤æ—¶é—´å‡åºï¼ˆè¶Šæ—©è¶Šå¥½ï¼‰

#### 4. `checksums` (å¯¹è±¡ï¼Œå¿…å¡«)
æ–‡ä»¶MD5æ ¡éªŒå’Œ

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `evaluate.py` | string | âœ… æ˜¯ | evaluate.pyæ–‡ä»¶çš„MD5å€¼ï¼Œå¿…é¡»åŒ¹é…é¢„è®¾å€¼ |

**å½“å‰é¢„è®¾MD5å€¼** (ä½œä¸š01): `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`

---

## ğŸ“¥ å“åº”ä½“ (Response)

### 1. æˆåŠŸ - 200 OK

```json
{
  "success": true,
  "message": "æäº¤æˆåŠŸï¼æˆç»©æå‡ï¼ˆ0.8536 â†’ 0.7536ï¼‰ï¼Œæ’è¡Œæ¦œå·²æ›´æ–°",
  "submission_count": 3,
  "leaderboard_updated": true,
  "current_rank": 5,
  "score": 0.7536,
  "previous_score": 0.8536
}
```

#### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `success` | boolean | æ˜¯å¦æˆåŠŸ |
| `message` | string | è¯¦ç»†æ¶ˆæ¯ |
| `submission_count` | integer | å½“å‰æäº¤æ¬¡æ•° |
| `leaderboard_updated` | boolean | æ’è¡Œæ¦œæ˜¯å¦æ›´æ–° |
| `current_rank` | integer/null | å½“å‰æ’å |
| `score` | float/null | å½“å‰åˆ†æ•°ï¼ˆRMSEå€¼ï¼‰ |
| `previous_score` | float/null | ä¹‹å‰çš„åˆ†æ•° |

#### å¯èƒ½çš„æˆåŠŸæ¶ˆæ¯

- `"é¦–æ¬¡æäº¤æˆåŠŸï¼Œå·²åŠ å…¥æ’è¡Œæ¦œ"` - ç¬¬ä¸€æ¬¡æäº¤
- `"æäº¤æˆåŠŸï¼æˆç»©æå‡ï¼ˆ0.8536 â†’ 0.7536ï¼‰ï¼Œæ’è¡Œæ¦œå·²æ›´æ–°"` - æˆç»©æå‡
- `"æäº¤æˆåŠŸï¼æˆç»©ä¸ä¹‹å‰ç›¸åŒï¼ˆ0.7536ï¼‰ï¼Œå·²æ›´æ–°æäº¤æ—¶é—´"` - æˆç»©ç›¸åŒ
- `"æäº¤æˆåŠŸï¼Œæˆç»©æœªæå‡ï¼ˆ0.8536 < 0.7536ï¼‰ï¼Œæ’è¡Œæ¦œä¸å˜"` - æˆç»©æœªæå‡
- `"æäº¤æˆåŠŸ"` - å…¶ä»–æƒ…å†µ

---

### 2. æˆªæ­¢æ—¶é—´è¶…æ—¶ - 400 Bad Request

```json
{
  "detail": "æäº¤è¶…æ—¶ï¼šå½“å‰æ—¶é—´å·²è¶…è¿‡ä½œä¸šæˆªæ­¢æ—¶é—´"
}
```

**å‘ç”Ÿæ¡ä»¶**: å½“å‰æ—¶é—´è¶…è¿‡ä½œä¸šæˆªæ­¢æ—¶é—´

---

### 3. æäº¤æ¬¡æ•°è¶…é™ - 400 Bad Request

```json
{
  "detail": "å·²è¾¾åˆ°æœ€å¤§æäº¤æ¬¡æ•°é™åˆ¶ï¼ˆ10æ¬¡ï¼‰"
}
```

**å‘ç”Ÿæ¡ä»¶**: å·²æäº¤æ¬¡æ•° â‰¥ æœ€å¤§å…è®¸æ¬¡æ•°ï¼ˆé»˜è®¤10æ¬¡ï¼‰

---

### 4. MD5æ ¡éªŒå¤±è´¥ - 400 Bad Request

```json
{
  "detail": "MD5æ ¡éªŒå¤±è´¥"
}
```

**å‘ç”Ÿæ¡ä»¶**: æäº¤çš„evaluate.pyçš„MD5å€¼ä¸é¢„è®¾å€¼ä¸åŒ¹é…

---

### 5. æ•°æ®æ ¼å¼é”™è¯¯ - 422 Unprocessable Entity

```json
{
  "detail": [
    {
      "loc": ["body", "student_info", "student_id"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

**å‘ç”Ÿæ¡ä»¶**: 
- ç¼ºå°‘å¿…å¡«å­—æ®µ
- å­—æ®µç±»å‹é”™è¯¯
- æ•°æ®æ ¼å¼ä¸ç¬¦åˆè¦æ±‚

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### Python ç¤ºä¾‹

```python
import requests
import hashlib

# è®¡ç®—æ–‡ä»¶MD5
def compute_file_md5(filepath):
    md5_hash = hashlib.md5()
    with open(filepath, 'rb') as f:
        for chunk in iter(lambda: f.read(4096), b""):
            md5_hash.update(chunk)
    return md5_hash.hexdigest()

# æäº¤æ•°æ®
url = "http://localhost:8000/api/submit"
data = {
    "student_info": {
        "student_id": "2021001234",
        "name": "å¼ ä¸‰",
        "nickname": "ä»£ç å°èƒ½æ‰‹"
    },
    "assignment_id": "01",
    "metrics": {
        "MAE": 0.1234,
        "MSE": 0.5678,
        "RMSE": 0.7536,
        "Prediction_Time": 12.34
    },
    "checksums": {
        "evaluate.py": compute_file_md5("evaluate.py")
    }
}

response = requests.post(url, json=data)
print(response.json())
```

### cURL ç¤ºä¾‹

```bash
curl -X POST "http://localhost:8000/api/submit" \
  -H "Content-Type: application/json" \
  -d '{
    "student_info": {
      "student_id": "2021001234",
      "name": "å¼ ä¸‰",
      "nickname": "ä»£ç å°èƒ½æ‰‹"
    },
    "assignment_id": "01",
    "metrics": {
      "MAE": 0.1234,
      "MSE": 0.5678,
      "RMSE": 0.7536,
      "Prediction_Time": 12.34
    },
    "checksums": {
      "evaluate.py": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
    }
  }'
```

---

## âš™ï¸ ç³»ç»Ÿé…ç½®

### ä½œä¸šé…ç½® (assignments.json)

```json
{
  "01": {
    "assignment_id": "01",
    "title": "ä½œä¸š1",
    "deadline": "2025-12-31T23:59:59Z",
    "checksums": {
      "evaluate.py": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
    },
    "max_submissions": 100
  }
}
```

### å…³é”®é…ç½®é¡¹

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `deadline` | æˆªæ­¢æ—¶é—´ï¼ˆUTCæ—¶é—´ï¼‰ | - |
| `max_submissions` | æœ€å¤§æäº¤æ¬¡æ•° | 10 |
| `checksums.evaluate.py` | evaluate.pyçš„MD5é¢„è®¾å€¼ | - |

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒº**: æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨UTCæ—¶åŒºï¼Œæ ¼å¼ä¸ºISO 8601
2. **MD5æ ¡éªŒ**: å¿…é¡»æäº¤æ­£ç¡®çš„evaluate.pyçš„MD5å€¼
3. **æäº¤é™åˆ¶**: é»˜è®¤æœ€å¤šæäº¤10æ¬¡ï¼ˆå¯åœ¨é…ç½®ä¸­ä¿®æ”¹ï¼‰
4. **æ’åºé€»è¾‘**: RMSE â†’ Prediction_Time â†’ æäº¤æ—¶é—´ï¼ˆå‡å‡åºï¼‰
5. **æ’è¡Œæ¦œæ›´æ–°**: ä»…å½“æ–°åˆ†æ•°ä¼˜äºæ—§åˆ†æ•°æ—¶æ‰æ›´æ–°æ’è¡Œæ¦œ
6. **nicknameå¯é€‰**: å¦‚ä¸éœ€è¦å¯è®¾ä¸ºnullæˆ–çœç•¥

---

## ğŸ” å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| `field required` | ç¼ºå°‘å¿…å¡«å­—æ®µ | æ£€æŸ¥æ‰€æœ‰å¿…å¡«å­—æ®µæ˜¯å¦æä¾› |
| `MD5æ ¡éªŒå¤±è´¥` | MD5å€¼ä¸åŒ¹é… | ä½¿ç”¨æ­£ç¡®çš„evaluate.pyæ–‡ä»¶ |
| `æäº¤è¶…æ—¶` | è¶…è¿‡æˆªæ­¢æ—¶é—´ | åœ¨æˆªæ­¢æ—¶é—´å‰æäº¤ |
| `æäº¤æ¬¡æ•°è¶…é™` | è¾¾åˆ°æœ€å¤§æ¬¡æ•° | æ— æ³•ç»§ç»­æäº¤ |
| `value is not a valid float` | æ•°å€¼ç±»å‹é”™è¯¯ | ç¡®ä¿metricsä¸­æ‰€æœ‰å€¼ä¸ºæ•°å­— |

---

**ç”Ÿæˆæ—¶é—´**: 2025-10-21  
**ç‰ˆæœ¬**: v1.0  
**åç«¯æ¡†æ¶**: FastAPI + Pydantic

